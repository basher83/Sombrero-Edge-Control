---
# Security hardening defaults - CIS Ubuntu 22.04 aligned

# SSH Configuration
security_ssh_port: 22
security_ssh_protocol: 2
security_ssh_permit_root_login: "no"
security_ssh_pubkey_authentication: "yes"
security_ssh_password_authentication: "no"
security_ssh_permit_empty_passwords: "no"
security_ssh_challenge_response_auth: "no"
security_ssh_gss_api_authentication: "no"
security_ssh_x11_forwarding: "no"
security_ssh_max_auth_tries: 3
security_ssh_max_sessions: 10
security_ssh_client_alive_interval: 300
security_ssh_client_alive_count_max: 0
security_ssh_login_grace_time: 60
security_ssh_allow_users:
  - ansible
security_ssh_deny_users: []
security_ssh_allow_groups: []
security_ssh_deny_groups: []
security_ssh_banner: "/etc/ssh/banner"
security_ssh_use_pam: "yes"
security_ssh_strict_modes: "yes"
security_ssh_tcp_keep_alive: "no"
security_ssh_compression: "no"
security_ssh_allowed_ciphers: "chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com"
security_ssh_allowed_macs: "hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512,hmac-sha2-256"
security_ssh_allowed_kex_algorithms: "sntrup761x25519-sha512@openssh.com,curve25519-sha256,curve25519-sha256@libssh.org,diffie-hellman-group-exchange-sha256"
security_ssh_host_key_algorithms: "ssh-ed25519,rsa-sha2-512,rsa-sha2-256"

# Kernel Hardening (sysctl)
security_kernel_hardening_enabled: true
security_sysctl_settings:
  # Network security
  net.ipv4.ip_forward: 0
  net.ipv6.conf.all.forwarding: 0
  net.ipv4.conf.all.send_redirects: 0
  net.ipv4.conf.default.send_redirects: 0
  net.ipv4.conf.all.accept_source_route: 0
  net.ipv4.conf.default.accept_source_route: 0
  net.ipv6.conf.all.accept_source_route: 0
  net.ipv6.conf.default.accept_source_route: 0
  net.ipv4.conf.all.accept_redirects: 0
  net.ipv4.conf.default.accept_redirects: 0
  net.ipv6.conf.all.accept_redirects: 0
  net.ipv6.conf.default.accept_redirects: 0
  net.ipv4.conf.all.secure_redirects: 0
  net.ipv4.conf.default.secure_redirects: 0
  net.ipv4.conf.all.log_martians: 1
  net.ipv4.conf.default.log_martians: 1
  net.ipv4.conf.all.rp_filter: 1
  net.ipv4.conf.default.rp_filter: 1
  net.ipv4.icmp_echo_ignore_broadcasts: 1
  net.ipv4.icmp_ignore_bogus_error_responses: 1
  net.ipv6.conf.all.accept_ra: 0
  net.ipv6.conf.default.accept_ra: 0
  net.ipv4.tcp_syncookies: 1
  net.ipv4.tcp_timestamps: 0
  # Kernel security
  kernel.randomize_va_space: 2
  fs.suid_dumpable: 0
  kernel.exec-shield: 1
  kernel.panic: 10
  kernel.panic_on_oops: 1
  kernel.ctrl-alt-del: 0
  kernel.kptr_restrict: 2
  kernel.yama.ptrace_scope: 1
  kernel.dmesg_restrict: 1
  kernel.unprivileged_bpf_disabled: 1
  net.core.bpf_jit_harden: 2
  # Process security
  fs.protected_hardlinks: 1
  fs.protected_symlinks: 1
  kernel.core_uses_pid: 1

# Fail2ban Configuration
security_fail2ban_enabled: true
security_fail2ban_ignoreip: "127.0.0.1/8 ::1"
security_fail2ban_bantime: 3600
security_fail2ban_findtime: 600
security_fail2ban_maxretry: 5
security_fail2ban_destemail: "root@localhost"
security_fail2ban_action: "%(action_mwl)s"
security_fail2ban_jails:
  - name: sshd
    enabled: true
    port: "{{ security_ssh_port }}"
    filter: sshd
    logpath: /var/log/auth.log
    maxretry: 3
    bantime: 7200
    findtime: 600

# System Audit and Logging
security_auditd_enabled: true
security_auditd_max_log_file: 8
security_auditd_max_log_file_action: rotate
security_auditd_num_logs: 5
security_auditd_space_left_action: email
security_auditd_action_mail_acct: root
security_auditd_admin_space_left_action: halt

# System Authentication
security_password_quality_enabled: true
security_password_min_length: 14
security_password_min_class: 3
security_password_max_repeat: 3
security_password_max_sequence: 3
security_password_remember: 5
security_password_encrypt_method: sha512

# Account Security
security_login_defs_pass_max_days: 90
security_login_defs_pass_min_days: 7
security_login_defs_pass_warn_age: 14
security_login_defs_umask: "027"
security_login_timeout: 60

# File Permissions
security_file_permissions_enabled: true
security_sensitive_files:
  - path: /etc/passwd
    owner: root
    group: root
    mode: "0644"
  - path: /etc/shadow
    owner: root
    group: shadow
    mode: "0640"
  - path: /etc/group
    owner: root
    group: root
    mode: "0644"
  - path: /etc/gshadow
    owner: root
    group: shadow
    mode: "0640"
  - path: /etc/ssh/sshd_config
    owner: root
    group: root
    mode: "0600"

# Process Accounting
security_process_accounting_enabled: true

# System Updates
security_automatic_updates_enabled: true
security_unattended_upgrades_enabled: true
security_unattended_upgrades_automatic_reboot: false
security_unattended_upgrades_automatic_reboot_time: "02:00"

# AppArmor
security_apparmor_enabled: true

# Disable unnecessary services
security_disabled_services:
  - avahi-daemon
  - cups
  - bluetooth
  - iscsid

# Network Time Protocol
security_ntp_enabled: true
security_ntp_servers:
  - 0.ubuntu.pool.ntp.org
  - 1.ubuntu.pool.ntp.org
  - 2.ubuntu.pool.ntp.org

# Firewall Integration
security_firewall_integration: true
security_firewall_type: "nftables"  # Can be 'ufw', 'iptables', or 'nftables'

# Security Validation
security_validation_enabled: true
security_validation_commands:
  - name: "SSH Configuration"
    command: "sshd -t"
  - name: "Fail2ban Status"
    command: "fail2ban-client status"
  - name: "Auditd Status"
    command: "auditctl -s"

# CIS Benchmark Compliance
security_cis_level: 1  # 1 or 2
security_cis_profile: "server"  # 'server' or 'workstation'

# Security Report
security_generate_report: true
security_report_path: "/var/log/security-hardening-report.txt"

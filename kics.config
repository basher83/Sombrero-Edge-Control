# KICS Configuration for Sombrero Edge Control Project
# Infrastructure as Code Security Scanning for Terraform/Proxmox Jump Host
# Last Updated: 2025-08-31
# KICS Version: 2.1.13+

# Scan specific paths for Terraform project
path: "."

# Platform types to scan - focused on Terraform and cloud-init
type:
  - Terraform
  - Dockerfile

# Exclude non-code and generated directories
exclude-paths:
  - "docs/"
  - "*.md"
  - "*.lock"
  - "renovate.json"
  - ".git/"
  - ".github/"
  - "kics-results/"
  - "reports/"
  - ".terraform/"
  - "*.tfstate"
  - "*.tfstate.backup"
  - ".terraform.lock.hcl"
  - "*.tfplan"
  - "__pycache__/"
  - "*.pyc"
  - ".pytest_cache/"
  - ".env"
  - ".venv/"
  - "venv/"
  - ".devcontainer/"
  - "scripts/"
  - ".mise.toml"
  - ".mise.local.toml"
  - ".infisical*"
  - "CHANGELOG.md"
  - "CLAUDE.md"
  # Exclude example files
  - "*-example.tf"
  - "*.example"
  - "*.tfvars.example"

# Exclude .gitignore paths automatically
exclude-gitignore: false

# Infrastructure-specific exclusions
exclude-categories:
  - "Observability"  # Not critical for jump host
  - "Build Process"  # Not applicable for Terraform

# Query exclusions with explanations
exclude-queries:
  # Proxmox provider doesn't support encryption at rest configuration
  - "3e70fdbf-a986-4d56-be32-7e7f0a0ba5f7"
  # SSH keys are managed via cloud-init, not in Terraform
  - "4c420f43-aa49-456a-b3f9-6b1fd4ec0e19"
  # Proxmox VMs use cloud-init for user data, not direct password auth
  - "08b81bb3-0db5-4bf5-9f69-29ff5923d3d5"
  # Backend configuration is handled via override files
  - "f2f52dc5-4dd3-4ea8-b6b7-d82f9e731d14"
  # VM monitoring is handled at Proxmox level
  - "4896b2e7-c86c-4eec-938f-5a19d395846f"

# Exclude specific severities to focus on critical issues
exclude-severities:
  - "INFO"
  - "TRACE"

# Output configuration
output-path: "/path/kics-results"
output-name: "results"
report-formats: "json,sarif,html"

# Logging configuration
log-file: true
log-path: "/path/kics-results/kics.log"
log-level: "INFO"

# Performance settings
no-progress: false
verbose: false  # Reduced verbosity for better CI performance
minimal-ui: false  # Full output for detailed results
preview-lines: 3  # Number of lines to display in CLI results (1-30)

# Parallel scanning optimization
parallel: 0  # Auto-detect optimal number of workers (0 = auto)

# File size and resolver limits
max-file-size: 5  # Max file size in MB (default: 5)
max-resolver-depth: 15  # Max depth for file resolution (default: 15)

# Disable features not needed for Terraform
disable-secrets: false  # Keep secrets scanning enabled
enable-openapi-refs: false  # Not needed for Terraform
disable-full-descriptions: false  # Keep full descriptions for clarity

# Secrets detection
secrets-regexes-path: ""  # Use default patterns

# Fail on specific severity levels (for CI/CD)
fail-on:
  - "HIGH"
  - "CRITICAL"

# Terraform-specific settings
terraform-vars-path: ""  # Variables are in environment via mise

# Query timeout
timeout: 60  # Seconds per query before cancellation (default: 60)

# Experimental queries
experimental-queries: false  # Only use thoroughly reviewed queries

# Bill of Materials (BoM)
bom: false  # Not needed for security scanning

# Ignore specific exit codes
ignore-on-exit: "none"  # Don't ignore any exit codes (options: all, results, errors, none)
